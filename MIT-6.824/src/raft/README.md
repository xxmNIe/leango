Here is some explanation to this Raft implementation.

# Procedure Setup

There are 3 kinds of procedures at hand, state procedure, async procedure, and callback procedure. These are run simultaniously inside a raft server process.

## State Procedure

Each state of raft corresponds to an action. This action is actively run by a thread. 

A leader periodically sends AppendEntries to all other peers.

A Candidate periodically sends RequestVote to all other peers after a random wait.

A Follower periodically checks its timer for `Timer Cleared` or `Timer Expired` events.

This is the main procedure happening inside the raft process.

## Async Procedure

There is a `TaskQueue` for every raft, holding some async task. A thread is devoted to running these tasks when they are present.

A thread is devoted to execute these tasks by popping from the `TaskQueue` one at a time.

An async task can be generated by RPCs. When the process receives an RPC, it pushes the corresponding task onto the `TaskQueue`.

An async task can also be generated by attempts to alter the state of the raft process, as is listed below.

- change peer state (leader, follower, candidate)
    - in terms may change peer current term count `currentTerm`
    - in terms may change peer assumed leader `votedFor`

## Callback Procedure

Callback happens when an RPC is responded. It is the result of async RPCs. All callbacks may only change the states appointed to them as `AsyncRpcInfo`. When it must change the other parts of the raft process, it must do this by pushing a task onto `TaskQueue`.

## Change in Peer State

The state of a raft instance may be changed in the process of the 2 threads as described above. It must be organized in an elegant way.

The key is how all means of executions handle the change in state.

### State Procedure

In the main state procedure, codes are called by **polymorphism**. As the attribute `myState` changes, its execution changes accordingly. We tend to the interface implementations of `RaftState` interface to maintain this procedure when state changes.

### Async Procedure

As all RPCs and peer state changes are allowed under any circumstances for any peers, async procedures are not effected directly by peer state transfer. No async procedure would be discarded when popped from `TaskQueue`.

Yet, an async procedure may act differently by condition or polymorphism for different peer state it sees.

### Callback Procedure

When an RPC returns, raft process state might have changed so that its original purpose is vain. This is done within the callback procedures.

## Peer State Lock

Async and Callback procedures may change peer state, while State procedure does not. Therefore, in Async and Callback procedures, the peer state is locked by provided mutex attribute `mu`.

# Go through Running


